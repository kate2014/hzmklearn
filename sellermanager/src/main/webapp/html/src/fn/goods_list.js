!function(t){t._({"~name":"goods.list","~superclass":t.base,ctor:function(){this.api="goods",this._super(),this.paginationCfg={pageSize:20},this.pageId=1},postCreate:function(){var t=this;this.$.loading.show(),this.$.create_time_start.cxCalendar(),this.$.create_time_end.cxCalendar(),this.$.searchBtn.keydown(function(o){var i=o.which;13==i&&t.$.searchBtn.click()}),$("body").keypress(function(o){13==o.keyCode&&t.searchResult()}),$("body").on("click",".j-up-down",function(){var o=$(this),i=o.parents("tr"),n=o.attr("data-id"),e=o.attr("data-type");"up"==e?t.upGoods(n,function(){o.attr("data-type","down").html("下架"),i.children().eq(8).find("span").html("上架")}):"down"==e&&t.downGoods(n,function(){o.attr("data-type","up").html("上架"),i.children().eq(8).find("span").html("下架")})}),this.request("brand_list")},initLazyLoad:function(){new cobra.ImageLazyLoad({mode:"manual",scope:100})},setClipboard:function(){var t=new ZeroClipboard($(".copy-btn"));t.on("ready",function(){t.on("copy",function(){}),t.on("aftercopy",function(){alert("商品链接复制成功!")})})},tipInit:function(){$("[title]").poshytip({className:"tip-twitter",showTimeout:1,alignTo:"target",alignX:"center",offsetY:5,allowTipHover:!1,fade:!1,slide:!1})},getGoodsListArgs:function(){var t=window.status||"",o=this.pageId?this.pageId:1;return this.statusKey="pending"==t?0:this.$.status_key?this.$.status_key.val():"",{type:"get",data:{status:t,key:this.$.good_key.val(),item_status:this.statusKey,brand_key:this.$.brand_key?this.$.brand_key.val():"",start_time:this.$.create_time_start.val(),end_time:this.$.create_time_end.val(),current_page:o,page_size:this.paginationCfg.pageSize},done:cobra.ride(this,function(o){this.$.loading.hide();var i="goods>goods_list_item";return"pending"==t&&(i="goods>goods_list_item_review"),$(o.data.data).each(function(t,o){"undefined"==typeof o.create_time&&(o.create_time="")}),console.log(o),$.when(this.compile(this.$.goods_list_box,i,o)).done(cobra.ride(this,function(){this.initLazyLoad(),this.setClipboard(),this.tipInit()})).fail(function(){}),$.when(this.compile(this.$.pageination,"goods>goods_list_pageination",this.initPaginationData(o))).done(cobra.ride(this,function(){})).fail(function(){}),o}),fail:function(){}}},brand_listArgs:function(){var t=this;return{type:"post",data:{},done:cobra.ride(t,function(o){$.when(this.compile(this.$.brand_key,"goods>brand_key",o)).done(cobra.ride(this,function(){this.request("getGoodsList")})).fail(function(o){arguments.length>1&&t._msgBox.warn(o.responseInfo.reasons.msg)})}),fail:function(t){arguments.length>1&&this._msgBox.warn(t.responseInfo.reasons.msg)}}},modifyGoods:function(t,o){window.location.href="../seller_goods_management/goods_modify.html?id="+t+"&modify="+$.trim(o)},deleteGoods:function(t){var o=this;miniDialog.confirm('<span style="color:red;font-weight:700;">确认要删除该商品?</span>',function(){o.goods_delArgs=null,o.goods_delArgs=function(){return{type:"get",data:{item_id:t},done:cobra.ride(o,function(){this._msgBox.done("商品已删除!"),this.$.goods_list_box.find("[data-id="+t+"]").remove()}),fail:function(){this._msgBox.info("商品删除失败，请稍后重试!")}}},o.request("goods_del")},function(){},{title:"温馨提示",width:300})},upGoods:function(t,o){var i=this;miniDialog.confirm('<span style="color:red;font-weight:700;">确认要上架该商品?</span>',function(){i.upGoodsArgs=null,i.upGoodsArgs=function(){return{type:"get",data:{item_id:t},done:cobra.ride(i,function(){this._msgBox.done("商品已上架!"),o()}),fail:function(){this._msgBox.info("操作异常，请稍后重试!")}}},i.request("upGoods")},function(){},{title:"温馨提示",width:300})},downGoods:function(t,o){var i=this;miniDialog.confirm('<span style="color:red;font-weight:700;">确认要下架该商品?</span>',function(){i.downGoodsArgs=null,i.downGoodsArgs=function(){return{type:"get",data:{item_id:t},done:cobra.ride(i,function(){this._msgBox.done("商品已下架!"),o()}),fail:function(){this._msgBox.info("操作异常，请稍后重试!")}}},i.request("downGoods")},function(){},{title:"温馨提示",width:300})},search_box_change:function(){var t=this,o=t.$.goods_search_input.val();""!=$.trim(o)&&this.request("goods_name_search")},goods_name_searchArgs:function(){var t=this;return{type:"post",data:{search_name:t.$.goods_search_input.val()},done:cobra.ride(t,function(o){$.when(this.compile(this.$.goods_search_result,"goods>goods_search_result_item",o)).done(cobra.ride(this,function(){this.$.goods_search_result.show()})).fail(function(o){arguments.length>1&&t._msgBox.warn(o.responseInfo.reasons.msg)})}),fail:function(t){arguments.length>1&&this._msgBox.warn(t.responseInfo.reasons.msg)}}},select_search_result:function(t){this.$.goods_search_result.hide(),this.$.goods_search_input.val(t)},goods_searchArgs:function(){var t=this;return{type:"get",data:{search_name:t.$.goods_search_input.val()},done:cobra.ride(t,function(t){return $.when(this.compile(this.$.goods_list_box,"goods>goods_list_item",t)).done(cobra.ride(this,function(){this.initLazyLoad()})).fail(function(){}),$.when(this.compile(this.$.pageination,"goods>goods_list_pageination",this.initPaginationData(t))).done(cobra.ride(this,function(){})).fail(function(){}),t}),fail:function(t){arguments.length>1&&this._msgBox.warn(t.responseInfo.reasons.msg)}}},search_submit:function(){this.$.goods_search_result.hide(),this.request("goods_search")},goPage:function(t){this.pageId=t,this.$.loading.show(),this.request("getGoodsList")},searchResult:function(){this.pageId=1,this.$.loading.show(),this.request("getGoodsList")},initPaginationData:function(t){return{page:Number(this.pageId),pagesize:this.paginationCfg.pageSize,total:Number(t.data.total_count),total_pages:Math.ceil(t.data.total_count/this.paginationCfg.pageSize)}}}),$(function(){new goods.list})}(cobra);