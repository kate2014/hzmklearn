!function(t){t._({"~name":"brand.add","~superclass":t.base,uQueue:[],cQ:[],ctor:function(){this.api="brand",this._super()},postCreate:function(){this.brandId=this.getQuery("id"),this.isEdit=!!this.brandId,this.$.loading.show(),this.request("getCategory"),this.$logoPreview=$("#logo-preview");{var t=this;new lib.imgUpload({trigger:".upload-image",onUploadStart:function(){t.targetInput=this.currentTrigger.parent().find("input"),this.currentTrigger.html("上传中..."),t.targetInput.val("loading...").prop("disabled",!0)},onUploadError:function(){t.targetInput.val("").prop("disabled",!1),this.currentTrigger.html("上传本地图片"),t._msgBox.warn(" 上传失败，请重试!"),delete t.targetInput},onUploadSuccess:function(a){if(this.currentTrigger.html("上传本地图片"),1e4==a.code){var e=a.data.thumb,i=a.data.url;t.targetInput.val(i).prop("disabled",!1),t.$logoPreview.attr("src",e).show(),t._msgBox.done("图片上传成功")}else t._msgBox.warn(" 上传失败，请重试!");delete t.targetInput}})}this.addEvent()},addEvent:function(){var t=this;t.$.logo.change(function(){var a=$.trim($(this).val());a&&t._validateImgSrc(a)&&t.$logoPreview.attr("src",a).show()})},_validateImgSrc:function(t){var a=/^http:\/\/.+\/.+(jpg|png|gif|bmp|jpeg)$/i;return a.test(t)},getCategoryArgs:function(){return{type:"get",data:{parent_id:0},done:cobra.ride(this,function(t){this.$.loading.hide(),$.when(this.compile(this.$.brandCategray,"brandList>brand_category_item",t)).done(cobra.ride(this,function(){this.isEdit&&this.renderData()})).fail(function(){})})}},addBrand:function(){this.validate()&&(this.setPostData(),this.request(this.isEdit?"brand_edit":"brand_add"))},brand_addArgs:function(){var t=this,a=this.postData;return{type:"get",data:a,done:cobra.ride(this,function(){t._msgBox.info("品牌添加成功!!!"),setTimeout(function(){window.location.href="../seller_goods_management/brand_list.html"},1e3)}),fail:function(){}}},brand_editArgs:function(){var t=this,a=this.postData;return{type:"get",data:a,done:cobra.ride(this,function(){t._msgBox.info("品牌修改成功!!!"),setTimeout(function(){window.location.href="../seller_goods_management/brand_list.html"},1e3)}),fail:function(){}}},validate:function(){var t=[];this.$.brandCategray.find(".brand-cate-check").each(function(){this.checked&&t.push(this.value)}),this.$.category_class.val(t.join(","));var a=this._agumentError(this._formValidate(this.$.markAddForm));return a?(this._msgBox.warn(a),!1):!0},_formValidate:function(t){var a="";return $(".require",t).each(function(){if($.nodeName(this,"input")||$.nodeName(this,"textarea")){if(""==$.trim($(this).val()))return a=$(this).parent().find("label").first().text().replace(/[\*:]/g,"")+"不能为空!",!1}else if($.nodeName(this,"ul")&&0==$(this).find("input:checked").size())return a=$(this).parent().find("label.ui-label").text().replace(/[\*:]/g,"")+"不能为空!",!1}),a},_agumentError:function(t){return t?t+"<br/>":""},setPostData:function(){this.postData={},this.postData.logo=this.$.logo.val(),this.postData.brand_desc=this.$.brand_desc.val(),this.postData.brand_name=this.$.brand_name.val(),this.postData.category_class=this.$.category_class.val(),this.brandId&&(this.postData.brand_id=this.brandId)},renderData:function(){var t=this;this.brand_get_detailArgs=null,this.brand_get_detailArgs=function(){return{type:"get",data:{brand_id:this.brandId},done:cobra.ride(this,function(a){var a=a.data;if(a.brand_desc&&this.$.brand_desc.val(a.brand_desc),a.brand_name&&this.$.brand_name.val(a.brand_name),a.logo&&(this.$.logo.val(a.logo),t.$logoPreview.attr("src",a.logo).show()),a.category_class){var e=a.category_class.split(",");if(e.length)for(var i=0,n=e.length;n>i;i++)$('input[value="'+e[i]+'"]')[0].checked=!0}}),fail:function(){}}},this.request("brand_get_detail")}}),$(function(){new brand.add})}(cobra);