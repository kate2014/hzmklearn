!function(t){t._({"~name":"seller.mark","+require":".require","~superclass":t.base,ctor:function(){this.api="mark",this.postData={},this._super()},postCreate:function(){this.$.loading.show(),this.request("mark_list"),this.$logoPreview=$("#logo-preview");{var t=this;new lib.imgUpload({trigger:".upload-image",onUploadStart:function(){t.targetInput=this.currentTrigger.parent().find("input"),this.currentTrigger.html("上传中..."),t.targetInput.val("loading...").prop("disabled",!0)},onUploadError:function(){t.targetInput.val("").prop("disabled",!1),this.currentTrigger.html("上传本地图片"),t._msgBox.warn(" 上传失败，请重试!"),delete t.targetInput},onUploadSuccess:function(i){if(this.currentTrigger.html("上传本地图片"),1e4==i.code){var r=i.data.thumb,a=i.data.url;t.targetInput.val(a).prop("disabled",!1),t._msgBox.done("图片上传成功"),t.$logoPreview.attr("src",r).show()}else t._msgBox.warn(" 上传失败，请重试!");delete t.targetInput}})}this.addEvent()},addEvent:function(){var t=this;t.$.icon_url.change(function(){var i=$.trim($(this).val());i&&t._validateImgSrc(i)&&t.$logoPreview.attr("src",i).show()})},_validateImgSrc:function(t){var i=/^http:\/\/.+\/.+(jpg|png|gif|bmp|jpeg)$/i;return i.test(t)},initLazyLoad:function(){new cobra.ImageLazyLoad({mode:"manual",scope:100})},showAdd:function(){this.$.markList.hide(),this.$.markAddFormBox.show()},showList:function(){this.$.markList.show(),this.$.markAddFormBox.hide()},mark_listArgs:function(){var t=this;return{type:"get",data:{},done:cobra.ride(this,function(i){return this.$.loading.hide(),$.when(this.compile(this.$.markList,"mark>mark_list",i)).done(cobra.ride(this,function(){t.initLazyLoad()})).fail(function(){}),i}),fail:function(){}}},deleteMark:function(t){var i=this;miniDialog.confirm('<span style="color:red;font-weight:700;">确认要删除该角标?</span>',function(){i.mark_delArgs=null,i.mark_delArgs=function(){return{type:"get",data:{icon_id:t},done:cobra.ride(i,function(){var i=this.$.markList.find('div[data-id="'+t+'"]');i.remove()}),fail:function(){}}},i.request("mark_del")},function(){},{title:"操作提示",width:300})},addMark:function(){this.validate()&&(this.setPostData(),this.request("mark_add"))},mark_addArgs:function(){return{type:"get",data:this.postData,done:cobra.ride(this,function(){location.reload()}),fail:function(){}}},validate:function(){var t=this._agumentError(this._formValidate(this.$.markAddForm));return t?(this._msgBox.warn(t),!1):!0},_formValidate:function(t){var i="";return $(seller.mark.require,t).each(function(){if($.nodeName(this,"input")){if(""==$.trim($(this).val()))return i=$(this).parent().find("label").text().replace(/[\*:]/g,"")+"不能为空!",!1}else if($.nodeName(this,"ul")&&0==$(this).find("input:checked").size())return i=$(this).parent().find("label.ui-label").text().replace(/[\*:]/g,"")+"不能为空!",!1}),i},_agumentError:function(t){return t?t+"<br/>":""},setPostData:function(){this.postData.icon_url=this.$.icon_url.val(),this.postData.icon_name=this.$.icon_name.val(),this.postData.icon_desc=this.$.icon_desc.val()}}),$(function(){new seller.mark})}(cobra);