!function(e){e.fn.cxCalendar=function(t,a){if(!(this.length<1)){var n,d={},s=d.jqobj=this,r=d.fun={};t=e.extend({},e.cxCalendar.defaults,t,{beginyear:s.data("beginyear"),endyear:s.data("endyear"),type:s.data("type"),hyphen:s.data("hyphen"),wday:s.data("wday")}),a=e.extend({},e.cxCalendar.language,a);var l=function(e){var t=e;return t=t.replace(/\./g,"/"),t=t.replace(/-/g,"/"),t=t.replace(/\//g,"/"),t=Date.parse(t)},o=function(e){return e%4==0&&e%100!=0||e%400==0?1:0};s.val().length>0&&(t.date=l(s.val())),t.date=new Date(t.date),isNaN(t.date.getFullYear())&&(t.date=new Date),t.date.setHours(0),t.date.setMinutes(0),t.date.setSeconds(0);var i,h,c,y,u,p,g=t.date.getFullYear(),v=t.date.getMonth()+1,f=(t.date.getDate(),new Array(31,28+o(g),31,30,31,30,31,31,30,31,30,31)),m=a.weekList,w=6-t.wday,b=7-t.wday>=7?0:7-t.wday;i=e("<div></div>",{"class":"cxcalendar"}),h=e("<div></div>",{"class":"date_hd"}).appendTo(i),y=e("<table></table>").appendTo(i);var D,x,j;h.html("<a class='date_pre' href='javascript://' rel='pre'>&lt;</a><a class='date_next' href='javascript://' rel='next'>&gt;</a>"),D=e("<div></div>",{"class":"date_txt"}).appendTo(h),c=e("<div></div>",{"class":"date_set"}).appendTo(h),p="";for(var k=t.beginyear;k<=t.endyear;k++)p+="<option value='"+k+"'>"+k+"</option>";x=e("<select></select>",{"class":"year_set"}).html(p).appendTo(c).val(g),c.append(" - "),p="";for(var k=0;12>k;k++)p+="<option value='"+(k+1)+"'>"+a.monthList[k]+"</option>";j=e("<select></select>",{"class":"month_set"}).html(p).appendTo(c).val(v),p="<thead><tr>";for(var k=0;7>k;k++)p+="<th class='",k==w?p+=" sat":k==b&&(p+=" sun"),p+="'>",p+=k+t.wday<7?m[k+t.wday]:m[k+t.wday-7],p+="</th>";return p+="</tr></thead>",p+="<tbody></tbody>",y.html(p),i.appendTo("body"),u=e("<div></div>",{"class":"cxcalendar_lock"}).appendTo("body"),r.show=function(){var e=document.body.clientWidth,t=document.body.clientHeight,n=i.outerWidth(),d=i.outerHeight(),r=s.offset().top,l=s.offset().left,o=s.outerWidth(),h=s.outerHeight();return r=r+d+h>t?r-d:r+h,l=l+n>e?l-(n-o):l,D.html("<span class='y'>"+x.val()+"</span>"+a.year+"<span class='m'>"+a.monthList[j.val()-1]+"</span>"+a.month),i.css({top:r,left:l}).show(),u.css({width:e,height:t}).show(),this},r.hide=function(){return i.hide(),u.hide(),c.hide(),D.show(),this},r.change=function(e,n){1>n?(e--,n=12):n>12&&(e++,n=1);var d=n;n--,e<t.beginyear?e=t.endyear:e>t.endyear&&(e=t.beginyear),f[1]=28+o(e),p="";var r=new Date(e,n,1),i=new Date;i.setHours(0),i.setMinutes(0),i.setSeconds(0);var h=new Date;h.setHours(0),h.setMinutes(0),h.setSeconds(0),h=l(s.val()),h=new Date(h),isNaN(h.getFullYear())&&(h=null);for(var c,u,g,v,m=r.getDay()-t.wday<0?r.getDay()-t.wday+7:r.getDay()-t.wday,k=Math.ceil((f[n]+m)/7),T=0;k>T;T++){p+="<tr>";for(var _=0;7>_;_++)c=7*T+_,u=c-m+1,u=0>=u||u>f[n]?"":c-m+1,p+="<td","number"==typeof u&&(g=null,v=null,r=new Date(e,n,u),g=Date.parse(i)-Date.parse(r),v=Date.parse(h)-Date.parse(r),p+=" title='"+e+t.hyphen+d+t.hyphen+u+"' class='num",0==v?p+=" selected":0==g?p+=" now":_==w?p+=" sat":_==b&&(p+=" sun"),p+="'"),p+=" data-day='"+u+"'>"+u+"</td>";p+="</tr>"}return y.find("tbody").html(p),D.html("<span class='y'>"+e+"</span>"+a.year+"<span class='m'>"+a.monthList[n]+"</span>"+a.month),x.val(e),j.val(n+1),this},r.selected=function(e){var a,n;return a=j.val(),n=e,"yyyy-mm-dd"==t.type&&(a="0"+j.val(),n="0"+e,a=a.substr(a.length-2,a.length),n=n.substr(n.length-2,n.length)),s.val(x.val()+t.hyphen+a+t.hyphen+n),s.trigger("change"),r.hide(),this},r.clear=function(){return s.val(""),r.change(g,v),r.hide(),this},r.getdate=function(){return s.val()},r.setdate=function(t,a,n){if("string"==typeof t)return void r.setdate({date:t});if("number"==typeof t&&"number"==typeof a&&"number"==typeof n)return void r.setdate({year:t,month:a,day:n});if("object"!=typeof t)return!1;t=e.extend({},{date:null,year:null,month:null,day:null,set:!0},t);var d;return"string"==typeof t.date&&(t.date=l(t.date),d=new Date(t.date),d.setHours(0),d.setMinutes(0),d.setSeconds(0),t.year=d.getFullYear(),t.month=d.getMonth()+1,t.day=d.getDate()),r.change(t.year,t.month),t.set&&r.selected(t.day),this},r.gotodate=function(e,t){return"string"==typeof e?r.setdate({date:e,set:!1}):"number"==typeof e&&"number"==typeof t&&r.setdate({year:e,month:t,day:1,set:!1}),this},i.delegate("a","click",function(){if(this.rel){var e=this.rel;switch(e){case"pre":return r.change(x.val(),parseInt(j.val(),10)-1),!1;case"next":return r.change(x.val(),parseInt(j.val(),10)+1),!1;case"clear":return r.clear(),!1}}}),y.delegate("td","click",function(){var t=e(this);t.hasClass("num")&&(y.find("td").removeClass("selected"),t.addClass("selected"),r.selected(t.data("day")))}),s.bind("click",r.show),u.bind("click",r.hide),D.bind("click",function(){D.hide(),c.show()}),x.bind("change",function(){r.change(x.val(),j.val())}),j.bind("change",function(){r.change(x.val(),j.val())}),r.change(g,v),n={jqobj:d.jqobj,show:r.show,hide:r.hide,getdate:r.getdate,setdate:r.setdate,gotodate:r.gotodate,clear:r.clear}}},e.cxCalendar={defaults:{beginyear:1950,endyear:2030,date:new Date,type:"yyyy-mm-dd",hyphen:"-",wday:0},language:{year:"年",month:"月",monthList:["1","2","3","4","5","6","7","8","9","10","11","12"],weekList:["日","一","二","三","四","五","六"]}}}(jQuery);