!function(t){function o(t){this.defaultOptions={formId:"mk-ajax-upload-form",targetUrl:"http://b.taojae.com/service.php",auth_name:"media_auth_key",auth_key:"6r4XkF6EcE",fileName:"images",trigger:".upload-image-trigger"},this.init(t)}o.prototype={init:function(t){if(this.opts=$.extend(!0,{},this.defaultOptions,t),$("#"+this.opts.formId).length)return this;var o=$('<form method="post" enctype="multipart/form-data" style="display: none">');o.attr("id",this.opts.formId),o.attr("action",this.opts.targetUrl);var i=$('<input name="'+this.opts.auth_name+'" type="hidden" value="'+this.opts.auth_key+'"/>');return i.appendTo(o),o.appendTo("body"),this.$form=o,this.setFileInput(),this.ajaxSubmit(),this.addEvent(),this},addEvent:function(){var t=this;$("body").on("click",this.opts.trigger,function(){t.uploading||(t.currentTrigger=$(this),t.$inputFile.click())})},setFileInput:function(){var t=this;this.$form.find("input[type=file]").remove(),this.$form.append('<input type="file" name="'+this.opts.fileName+'" />'),this.$inputFile=this.$form.find("input[type=file]"),this.$inputFile.change(function(){t.$form.submit()})},ajaxSubmit:function(){var t=this;this.$form.ajaxForm({dataType:"json",beforeSend:function(){t.uploading=!0,t.opts.onUploadStart&&t.opts.onUploadStart.call(t)},uploadProgress:function(o,i,e,n){t.opts.onUploadProgress&&t.opts.onUploadProgress.call(t,n)},success:function(o){t.opts.onUploadSuccess&&t.opts.onUploadSuccess.call(t,o)},error:function(){t.opts.onUploadError&&t.opts.onUploadError.call(t)},complete:function(o){t.uploading=!1,t.setFileInput(),t.opts.onUploadComplete&&t.opts.onUploadComplete.call(t,o)}})}},t.imgUpload=o}(window.lib||(window.lib={}));